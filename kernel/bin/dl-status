#!/bin/bash

. /etc/docklet/docklet.conf

[[ "`whoami`" != "root" ]] && echo "Root previledge required!" && exit 1

if [[ "$@" == "local" ]]; then
	echo "[Host: `dl-join network`]"
	for LXC in `lxc-ls`; do
		echo -e "* lxc: '${LXC}', using cpu - `cat /sys/fs/cgroup/cpuacct/lxc/${LXC}/cpuacct.usage` ns, memory - `cat /sys/fs/cgroup/memory/lxc/${LXC}/memory.usage_in_bytes` Byte"
	done
	exit 0
fi

echo "=============================================="

echo "[Docklet Physical Hosts]"
ls /home/docklet/global/database/machines
#curl -L http://0.0.0.0:4001/v2/keys/_etcd/machines 2>/dev/null | python -mjson.tool | grep key.:../_etcd/machines/1 | awk -F\" '{print $4}' | awk -F\/ '{print $NF}'
echo

echo "[Clusters Status]"
INSTS=`ls /home/docklet/global/database/instances`
if [[ "${INSTS}" != "" ]]; then
	for ID in ${INSTS}; do
		echo -n "* ${ID} -- "
		cat /home/docklet/global/database/instances/${ID}
	done
fi
#curl -L http://0.0.0.0:4001/v2/keys/docklet/instances/ 2>/dev/null | python -mjson.tool | grep value.: | awk -F\" '{print $4}'
echo

echo "=============================================="
